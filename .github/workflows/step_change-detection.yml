name: Detect file changes
on:
  workflow_call:
    outputs:
      docs_changed:
        description: Documentation changed
        value: ${{ jobs.change-detection.outputs.docs_changed }}
      base_changed:
        description: Base Swig files changed
        value: ${{ jobs.change-detection.outputs.base_changed }}
      langs:
        description: Swig languages affected
        value: ${{ jobs.change-detection.outputs.langs }}


jobs:
  change-detection:
    name: Gather commit changes
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Check documentation
        id: docs
        uses: tj-actions/changed-files@v38
        with:
          files: |
            Doc/**
      - name: Check Swig base
        id: base
        uses: tj-actions/changed-files@v38
        with:
          files: |
            Source/**
            Lib/std/**
            Lib/typemaps/**
            Lib/xml/**
            Lib/*
      - name: Check Swig language
        id: lang
        uses: tj-actions/changed-files@v38
        with:
          path: Lib
          files: |
            */**
          files_ignore: |
            .fmf/*
            std/**
            typemaps/**
            xml/**
          # Get only the names of the languages (first directory name after /Lib)
          json: true
          dir_names: true
          dir_names_max_depth: 1
          escape_json: false
      - name: Print changes
        run: |
          echo "docs_changed = ${{ steps.docs.outputs.any_modified }}"
          echo "docs_files = ${{ steps.docs.outputs.all_modified_files }}"
          echo "base_changed = ${{ steps.base.outputs.any_modified }}"
          echo "base_files = ${{ steps.base.outputs.all_modified_files }}"
          echo "langs_changed = ${{ steps.lang.outputs.any_modified }}"
          echo "langs_files = ${{ steps.lang.outputs.all_modified_files }}"
    outputs:
      docs_changed: ${{ steps.docs.outputs.any_modified }}
      base_changed: ${{ steps.base.outputs.any_modified }}
      langs: ${{ steps.lang.outputs.all_modified_files }}
